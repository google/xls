package test_module

file_number 0 "test_module.x"

fn __itok__test_module__test_utility_function(__token: token id=1, __activated: bits[1] id=2) -> (token, ()) {
  trace.3: token = trace(__token, __activated, format="Message from a test utility function", data_operands=[], id=3)
  after_all.5: token = after_all(trace.3, id=5)
  tuple.4: () = tuple(id=4)
  ret tuple.6: (token, ()) = tuple(after_all.5, tuple.4, id=6)
}

fn __itok__test_module__normal_function(__token: token id=7, __activated: bits[1] id=8) -> (token, ()) {
  trace.9: token = trace(__token, __activated, format="Message from a normal function", data_operands=[], id=9)
  after_all.11: token = after_all(trace.9, id=11)
  tuple.10: () = tuple(id=10)
  ret tuple.12: (token, ()) = tuple(after_all.11, tuple.10, id=12)
}

fn __itok__test_module__test_func(__token: token id=13, __activated: bits[1] id=14) -> (token, ()) {
  invoke.15: (token, ()) = invoke(__token, __activated, to_apply=__itok__test_module__test_utility_function, id=15)
  invoke.18: (token, ()) = invoke(__token, __activated, to_apply=__itok__test_module__normal_function, id=18)
  tuple_index.16: token = tuple_index(invoke.15, index=0, id=16)
  tuple_index.19: token = tuple_index(invoke.18, index=0, id=19)
  trace.21: token = trace(__token, __activated, format="Message from a test function", data_operands=[], id=21)
  after_all.23: token = after_all(tuple_index.16, tuple_index.19, trace.21, id=23)
  tuple.22: () = tuple(id=22)
  tuple_index.17: () = tuple_index(invoke.15, index=1, id=17)
  tuple_index.20: () = tuple_index(invoke.18, index=1, id=20)
  ret tuple.24: (token, ()) = tuple(after_all.23, tuple.22, id=24)
}

proc __test_module__TestUtilityProc_0_next<req_r: () in, resp_s: () out>(__state: (), init={()}) {
  chan_interface req_r(direction=receive, kind=streaming, strictness=proven_mutually_exclusive, flow_control=ready_valid, flop_kind=none)
  chan_interface resp_s(direction=send, kind=streaming, strictness=proven_mutually_exclusive, flow_control=ready_valid, flop_kind=none)
  after_all.29: token = after_all(id=29)
  literal.27: bits[1] = literal(value=1, id=27)
  receive.30: (token, ()) = receive(after_all.29, predicate=literal.27, channel=req_r, id=30)
  __token: token = literal(value=token, id=25)
  tok: token = tuple_index(receive.30, index=0, id=32)
  tuple.35: () = tuple(id=35)
  __state: () = state_read(state_element=__state, id=26)
  tuple.37: () = tuple(id=37)
  tuple.28: () = tuple(id=28)
  tuple_index.31: token = tuple_index(receive.30, index=0, id=31)
  tuple_index.33: () = tuple_index(receive.30, index=1, id=33)
  trace.34: token = trace(__token, literal.27, format="Message from a TestUtilityProc", data_operands=[], id=34)
  send.36: token = send(tok, tuple.35, predicate=literal.27, channel=resp_s, id=36)
  next_value.38: () = next_value(param=__state, value=tuple.37, id=38)
}

proc __test_module__NormalProc_0_next<req_r: () in, resp_s: () out>(__state: (), init={()}) {
  chan_interface req_r(direction=receive, kind=streaming, strictness=proven_mutually_exclusive, flow_control=ready_valid, flop_kind=none)
  chan_interface resp_s(direction=send, kind=streaming, strictness=proven_mutually_exclusive, flow_control=ready_valid, flop_kind=none)
  after_all.43: token = after_all(id=43)
  literal.41: bits[1] = literal(value=1, id=41)
  receive.44: (token, ()) = receive(after_all.43, predicate=literal.41, channel=req_r, id=44)
  __token: token = literal(value=token, id=39)
  tok: token = tuple_index(receive.44, index=0, id=46)
  tuple.49: () = tuple(id=49)
  __state: () = state_read(state_element=__state, id=40)
  tuple.51: () = tuple(id=51)
  tuple.42: () = tuple(id=42)
  tuple_index.45: token = tuple_index(receive.44, index=0, id=45)
  tuple_index.47: () = tuple_index(receive.44, index=1, id=47)
  trace.48: token = trace(__token, literal.41, format="Message from a NormalProc", data_operands=[], id=48)
  send.50: token = send(tok, tuple.49, predicate=literal.41, channel=resp_s, id=50)
  next_value.52: () = next_value(param=__state, value=tuple.51, id=52)
}

top proc __test_module__TestProc_0_next<terminator: bits[1] out>(__state: (), init={()}) {
  chan_interface terminator(direction=send, kind=streaming, strictness=proven_mutually_exclusive, flow_control=ready_valid, flop_kind=none)
  chan tester_req((), id=0, kind=streaming, ops=send_receive, flow_control=ready_valid, strictness=proven_mutually_exclusive)
  chan_interface tester_req(direction=send, kind=streaming, strictness=proven_mutually_exclusive, flow_control=none, flop_kind=none)
  chan_interface tester_req(direction=receive, kind=streaming, strictness=proven_mutually_exclusive, flow_control=none, flop_kind=none)
  chan tester_resp((), id=1, kind=streaming, ops=send_receive, flow_control=ready_valid, strictness=proven_mutually_exclusive)
  chan_interface tester_resp(direction=send, kind=streaming, strictness=proven_mutually_exclusive, flow_control=none, flop_kind=none)
  chan_interface tester_resp(direction=receive, kind=streaming, strictness=proven_mutually_exclusive, flow_control=none, flop_kind=none)
  chan user_req((), id=2, kind=streaming, ops=send_receive, flow_control=ready_valid, strictness=proven_mutually_exclusive)
  chan_interface user_req(direction=send, kind=streaming, strictness=proven_mutually_exclusive, flow_control=none, flop_kind=none)
  chan_interface user_req(direction=receive, kind=streaming, strictness=proven_mutually_exclusive, flow_control=none, flop_kind=none)
  chan user_resp((), id=3, kind=streaming, ops=send_receive, flow_control=ready_valid, strictness=proven_mutually_exclusive)
  chan_interface user_resp(direction=send, kind=streaming, strictness=proven_mutually_exclusive, flow_control=none, flop_kind=none)
  chan_interface user_resp(direction=receive, kind=streaming, strictness=proven_mutually_exclusive, flow_control=none, flop_kind=none)
  proc_instantiation __test_module__TestUtilityProc_0_next_inst(tester_req, tester_resp, proc=__test_module__TestUtilityProc_0_next)
  proc_instantiation __test_module__NormalProc_0_next_inst(user_req, user_resp, proc=__test_module__NormalProc_0_next)
  after_all.68: token = after_all(id=68)
  literal.55: bits[1] = literal(value=1, id=55)
  after_all.60: token = after_all(id=60)
  receive.69: (token, ()) = receive(after_all.68, predicate=literal.55, channel=user_resp, id=69)
  after_all.57: token = after_all(id=57)
  tuple.58: () = tuple(id=58)
  receive.61: (token, ()) = receive(after_all.60, predicate=literal.55, channel=tester_resp, id=61)
  after_all.65: token = after_all(id=65)
  tuple.66: () = tuple(id=66)
  __token: token = literal(value=token, id=53)
  tok__3: token = tuple_index(receive.69, index=0, id=71)
  literal.74: bits[1] = literal(value=1, id=74)
  __state: () = state_read(state_element=__state, id=54)
  tuple.76: () = tuple(id=76)
  tuple.56: () = tuple(id=56)
  tok: token = send(after_all.57, tuple.58, predicate=literal.55, channel=tester_req, id=59)
  tuple_index.62: token = tuple_index(receive.61, index=0, id=62)
  tok__1: token = tuple_index(receive.61, index=0, id=63)
  tuple_index.64: () = tuple_index(receive.61, index=1, id=64)
  tok__2: token = send(after_all.65, tuple.66, predicate=literal.55, channel=user_req, id=67)
  tuple_index.70: token = tuple_index(receive.69, index=0, id=70)
  tuple_index.72: () = tuple_index(receive.69, index=1, id=72)
  trace.73: token = trace(__token, literal.55, format="Message from a TestProc", data_operands=[], id=73)
  send.75: token = send(tok__3, literal.74, predicate=literal.55, channel=terminator, id=75)
  next_value.77: () = next_value(param=__state, value=tuple.76, id=77)
}
